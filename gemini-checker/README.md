# Gemini节点检测器

一个用于检测Surge策略组中哪些节点可以访问Gemini API的模块，支持iOS和macOS平台。

## 功能特性

- ✅ 自动检测指定策略组中的所有节点
- ✅ 测试每个节点到Gemini API的连通性
- ✅ 测量每个节点的响应延时
- ✅ 按延时从低到高排序显示结果
- ✅ 支持自定义策略组名称
- ✅ 在Surge面板中实时显示检测结果

## 安装方法

### 方法一：通过URL安装（推荐）

1. 打开Surge应用
2. 进入 `配置` → `模块`
3. 点击右上角 `+` 按钮
4. 选择 `Install Module from URL`
5. 输入模块URL（上传到GitHub后提供）
6. 点击 `确定` 安装

### 方法二：手动安装

1. 下载本仓库的文件：
   - `gemini_checker.sgmodule`
   - `gemini_checker.js`

2. 将两个文件放在同一目录下（推荐使用iCloud Drive）

3. 在Surge中添加模块：
   - 打开Surge → `配置` → `模块`
   - 点击 `+` → `Install from File`
   - 选择 `gemini_checker.sgmodule` 文件

## 使用方法

### 前置要求

1. 确保你的Surge配置中有名为 **"Gemini"** 的策略组
2. 策略组中包含多个代理节点

### 运行检测

1. 打开Surge应用
2. 在主界面找到 **"Gemini节点检测"** 面板
3. 点击面板即可开始检测
4. 等待几秒钟后，面板会显示检测结果

### 自定义策略组

如果你的策略组名称不是"Gemini"，可以修改模块文件：

```ini
[Script]
gemini_checker = type=generic,timeout=60,script-path=gemini_checker.js,argument=你的策略组名
```

将 `argument=Gemini` 改为你的实际策略组名称。

## 结果说明

检测结果会显示：

### 可用节点
- 🥇🥈🥉 前三名节点会有特殊标记
- 显示每个节点的延时（毫秒）
- 按延时从低到高排序

### 不可用节点
- 显示无法连接的节点
- 显示错误原因（超时、连接失败等）
- 最多显示5个，避免列表过长

### 示例输出

```
✅ 最快: 香港节点01 (234ms)

✅ 可用节点 (3个):
🥇 香港节点01
   延时: 234ms
🥈 新加坡节点02
   延时: 356ms
🥉 日本节点03
   延时: 412ms

❌ 不可用节点 (2个):
▫️ 美国节点01
   错误: Connection timeout
▫️ 台湾节点02
   错误: HTTP 403
```

## 技术说明

### 检测原理

- 使用Gemini API的Models列表端点进行测试
- 测试URL: `https://generativelanguage.googleapis.com/v1/models`
- 通过不同节点发起HTTP请求，验证连通性
- 记录请求响应时间作为延时指标

### 超时设置

- 单节点测试超时：5秒
- 脚本总超时：60秒

### 状态码说明

- **200**: 成功连接到Gemini API
- **403**: 网络连接正常，但可能需要API Key（仍算可用）
- **其他**: 连接失败或不可用

## 常见问题

### Q: 所有节点都显示不可用？
A: 可能的原因：
- 检查网络连接是否正常
- 确认Gemini服务是否可访问
- 尝试手动访问 `generativelanguage.googleapis.com` 确认

### Q: 检测时间过长？
A: 正常情况下，检测时间 = 节点数量 × 平均延时。如果节点较多，建议：
- 减少策略组中的节点数量
- 或者耐心等待检测完成

### Q: 能否自动选择最快的节点？
A: 当前版本仅提供检测和展示功能，不会自动切换节点。你需要根据检测结果手动选择节点。

## 版本历史

### v1.0.0 (2026-01-06)
- 🎉 初始版本发布
- ✅ 实现节点发现功能
- ✅ 实现Gemini连通性测试
- ✅ 实现延时测量和排序
- ✅ 实现面板展示

## 许可证

MIT License

## 作者

Created with ❤️ for Surge users
